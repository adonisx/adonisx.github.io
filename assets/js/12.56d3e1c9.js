(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{334:function(t,e,s){"use strict";s.r(e);var a=s(33),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"extensions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#extensions"}},[t._v("#")]),t._v(" Extensions")]),t._v(" "),s("h2",{attrs:{id:"why"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#why"}},[t._v("#")]),t._v(" Why?")]),t._v(" "),s("p",[t._v("In the real world, everybody needs more than saving and listing records. Everybody needs more complicated logic in their code. "),s("strong",[t._v("AdonisX")]),t._v(" provides you a basic structure of an API. It provides you basic CRUD actions with where dynamic query options. But when you need custom logic, you will not be alone. "),s("strong",[t._v("AdonisX")]),t._v(" provides you some points to extend your HTTP requests and manipulate them.")]),t._v(" "),s("p",[t._v("There are two different ways to add your business logic;")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Events")])]),t._v(" "),s("li",[s("strong",[t._v("Actions")])])]),t._v(" "),s("p",[t._v("You may use "),s("strong",[t._v("Events")]),t._v(" and "),s("strong",[t._v("Actions")]),t._v(" to add your business logic.")]),t._v(" "),s("h2",{attrs:{id:"events"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#events"}},[t._v("#")]),t._v(" Events")]),t._v(" "),s("p",[s("strong",[t._v("Events")]),t._v(" are AdonisJS' features and you can read its documentation in "),s("a",{attrs:{href:"https://adonisjs.com/docs/4.1/events",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),s("OutboundLink")],1),t._v(". It is very simple to use. First, you define an event to listen;")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// start/event.js")]),t._v("\n\nEvent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'new::user'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'User.registered'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("Then you create a file which is called "),s("code",[t._v("User.js")]),t._v(" under the "),s("code",[t._v("app/Listeners")]),t._v(" directory like this;")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/Listeners/User.js")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" User "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nUser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("register")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("params")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Your business logic.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("After these definitions, whenever you fire the event, your "),s("code",[t._v("register")]),t._v(" method will be triggered.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("Event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'new::user'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("AdonisX uses this structure. It fires constant events when an event has appeared. For example, if you want to handle the user's request before pagination, you should define an event like this;")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("Event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'onBeforePaginateUser'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'User.onBeforePaginate'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("AdonisX automatically fires "),s("code",[t._v("onBeforePaginate")]),t._v(" event before the pagination in "),s("code",[t._v("MainController")]),t._v(". You can use the following list to understand which events will be triggered by AdonisX;")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("EventName{Model}")]),t._v(" "),s("th",[t._v("Variables")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("onBeforeCreate{User}")]),t._v(" "),s("td",[t._v("request, params, data")])]),t._v(" "),s("tr",[s("td",[t._v("onBeforeUpdate{User}")]),t._v(" "),s("td",[t._v("request, params, item")])]),t._v(" "),s("tr",[s("td",[t._v("onBeforeDelete{User}")]),t._v(" "),s("td",[t._v("request, params, query")])]),t._v(" "),s("tr",[s("td",[t._v("onBeforePaginate{User}")]),t._v(" "),s("td",[t._v("request, params, query")])]),t._v(" "),s("tr",[s("td",[t._v("onBeforeShow{User}")]),t._v(" "),s("td",[t._v("request, params, query")])]),t._v(" "),s("tr",[s("td",[t._v("onAfterCreate{User}")]),t._v(" "),s("td",[t._v("request, params, data, item")])]),t._v(" "),s("tr",[s("td",[t._v("onAfterUpdate{User}")]),t._v(" "),s("td",[t._v("request, params, item")])]),t._v(" "),s("tr",[s("td",[t._v("onAfterDelete{User}")]),t._v(" "),s("td",[t._v("request, params, item")])]),t._v(" "),s("tr",[s("td",[t._v("onAfterPaginate{User}")]),t._v(" "),s("td",[t._v("request, params, result")])]),t._v(" "),s("tr",[s("td",[t._v("onAfterShow{User}")]),t._v(" "),s("td",[t._v("request, params, item")])])])]),t._v(" "),s("h2",{attrs:{id:"actions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#actions"}},[t._v("#")]),t._v(" Actions")]),t._v(" "),s("p",[t._v("The main difference between "),s("strong",[t._v("Actions")]),t._v(" and "),s("strong",[t._v("Events")]),t._v(" is; events are "),s("strong",[t._v("asynchronous")]),t._v(". It means that if you are using an "),s("strong",[t._v("action")]),t._v(" and handle the request, the HTTP request cycle waits for you to do your task. But in events, when you handle the event, the HTTP requests cycle keeps working and returns a response. So, if you want to send an e-mail to the user, you should use "),s("strong",[t._v("Events")]),t._v(". On the other hand, if you want to be involved in the query or any business logic in the HTTP request cycle, you should use "),s("strong",[t._v("Actions")]),t._v(".")]),t._v(" "),s("p",[t._v("Using "),s("strong",[t._v("Actions")]),t._v(" is very easy. The only thing you do, you should create an Action file for your model under the directory "),s("code",[t._v("app/Actions")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/Actions/UserActions.js")]),t._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onBeforePaginate")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" query "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Implement your business logic in here.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("If you create an action file like this, every time before pagination of "),s("strong",[t._v("User.js")]),t._v(" model, this method will be triggered. The only thing you should care about is using the same naming structure for model and action file;")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Model")]),t._v(" "),s("th",[t._v("Actions")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("User.js")]),t._v(" "),s("td",[t._v("UserActions.js")])]),t._v(" "),s("tr",[s("td",[t._v("Users.js")]),t._v(" "),s("td",[t._v("UsersActions.js")])]),t._v(" "),s("tr",[s("td",[t._v("UserPost.js")]),t._v(" "),s("td",[t._v("UserPostActions.js")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("Actions are loaded in the "),s("strong",[t._v("initialization")]),t._v(" process at *"),s("strong",[t._v("once")]),t._v(". So your action methods should be "),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/State_(computer_science)#Program_state",target:"_blank",rel:"noopener noreferrer"}},[t._v("stateless"),s("OutboundLink")],1),t._v(".")])]),t._v(" "),s("p",[t._v("You can handle every action on models. Please look at the following tables;")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("ActionName")]),t._v(" "),s("th",[t._v("Variables")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("onBeforeCreate")]),t._v(" "),s("td",[t._v("request, params, data")])]),t._v(" "),s("tr",[s("td",[t._v("onBeforeUpdateQuery")]),t._v(" "),s("td",[t._v("request, params, query")])]),t._v(" "),s("tr",[s("td",[t._v("onBeforeUpdate")]),t._v(" "),s("td",[t._v("request, params, item")])]),t._v(" "),s("tr",[s("td",[t._v("onBeforeDelete")]),t._v(" "),s("td",[t._v("request, params, query")])]),t._v(" "),s("tr",[s("td",[t._v("onBeforePaginate")]),t._v(" "),s("td",[t._v("request, params, query")])]),t._v(" "),s("tr",[s("td",[t._v("onBeforeShow")]),t._v(" "),s("td",[t._v("request, params, query")])]),t._v(" "),s("tr",[s("td",[t._v("onAfterCreate")]),t._v(" "),s("td",[t._v("request, params, data, item")])]),t._v(" "),s("tr",[s("td",[t._v("onAfterUpdateQuery")]),t._v(" "),s("td",[t._v("request, params, item")])]),t._v(" "),s("tr",[s("td",[t._v("onAfterUpdate")]),t._v(" "),s("td",[t._v("request, params, item")])]),t._v(" "),s("tr",[s("td",[t._v("onAfterDelete")]),t._v(" "),s("td",[t._v("request, params, item")])]),t._v(" "),s("tr",[s("td",[t._v("onAfterPaginate")]),t._v(" "),s("td",[t._v("request, params, result")])]),t._v(" "),s("tr",[s("td",[t._v("onAfterShow")]),t._v(" "),s("td",[t._v("request, params, item")])])])]),t._v(" "),s("h2",{attrs:{id:"variables"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#variables"}},[t._v("#")]),t._v(" Variables")]),t._v(" "),s("p",[t._v("There are some variables which you can use in a trigger or event function;")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://adonisjs.com/docs/4.1/request",target:"_blank",rel:"noopener noreferrer"}},[t._v("request"),s("OutboundLink")],1),t._v(" Request object of "),s("a",{attrs:{href:"https://adonisjs.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("AdonisJs"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("strong",[t._v("params")]),t._v(": Query parameters in url. ("),s("code",[t._v("api/users/:userId/posts/:id")]),t._v(", "),s("code",[t._v("userId")]),t._v(" and "),s("code",[t._v("id")]),t._v(")")]),t._v(" "),s("li",[s("strong",[t._v("data")]),t._v(": The data has been sent by user to create or update.")]),t._v(" "),s("li",[s("strong",[t._v("item")]),t._v(": The record which is active.")]),t._v(" "),s("li",[s("strong",[t._v("query")]),t._v(": The "),s("a",{attrs:{href:"https://adonisjs.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("AdonisJs"),s("OutboundLink")],1),t._v("' "),s("a",{attrs:{href:"https://adonisjs.com/docs/4.1/lucid#_query_builder",target:"_blank",rel:"noopener noreferrer"}},[t._v("query"),s("OutboundLink")],1),t._v(" object before executing query.")])])])}),[],!1,null,null,null);e.default=r.exports}}]);